# Briko 区块链社区语料制作流程，工作量估算与奖励机制

Version:0.1 草案 @ 2019年3月12日

## ——目录——

1. [总目标与概述](#总目标与概述)

2. [Phase 1 - 语料审核打分](#phase-1---语料审核打分)

   [目标与概述](#目标与概述)

   [社区流程要点](#社区流程要点)

   [模型与步骤](#模型与步骤)

   1. [定义任务](#1-定义任务)

   2. [机器过滤语料](#2-机器过滤语料)

   3. [人工审核评分](#3-人工审核评分)

   4. [机器分组](#4-机器分组)

   5. [总结](#5-总结)

   [工作量估算](#工作量估算)

   [奖励规则与计算](#奖励规则与计算)

3. [Phase 2 & 3](#Phase-2--3)

   [参考文献](#参考文献)

## ——总目标与概述——

本文档的主要目标是设计一个流程，通过非专业人员众包制作高质量语料。流程需清晰明确，可模块化，并精确量化工作量。主要模块包括审核打分，编辑修改和新语料制作，原始数据由Briko提供。设计一套打分系统评估社区成员的语言水平能力，估算工作总量，设计奖励机制。语料处理流程框架图如下：

<img src="/img/overall_flow.png" width="480">

以下是各个模块的详细流程与建模。

## ——Phase 1 - 语料审核打分——

### **目标与概述**

设计一个流程通过非专业人员众包清洗已有语料库或网络爬取的粗糙语料。流程包括机器过滤和人工审核，原始数据由Briko提供。需要对整个流程工作量进行估计，设计一套打分系统评估社区用户的语言能力，设计贡献者奖励机制。

### **社区流程要点**

* 设计一套基于社区协作的打分系统，评估社区用户的语言能力。
* 针对协作的过程和工作单元的目标，Briko制定一些规则，社区监督完成目标。
* 根据社区用户表现计算每人的权重参数，打分时权重参数影响分数。
* 根据权重分数，总工作量等参数，计算每人的贡献值，给与奖励。
* 利用挑战任务以及权重参数防范恶意打分。
* 之后还可以有下一步任务，例如语料编辑修改等，可以进一步提高语料质量。

### **模型与步骤**

#### 1. 定义任务

此步骤无需社区人工。Briko确定一个语料清洗的任务，可以是清理爬虫抓取的粗糙语料，或是对现有的语料库进一步清洗。假设原始数据是 *P* 份（句/段/篇）原始语料，清洗目标是清理出 *k * P* 份最终语料 (*0 < k < 1*)。语料有多种类型，例如双语平行语料，带有情感标记的语料，问答语料等等，以下以双语平行语料作为例子。总工作量为 *W<sub>Phase1</sub>*，总预算为 *BGE<sub>budget</sub>*。

#### 2. 机器过滤语料[1][2]

此步骤无需社区人工。设计若干标准对语料进行粗筛，例如：

* 对应语料*S*，*T*长度相差必须在某范围内（例如*0.4 < S/T < 2.5*）。
* 特殊token必须在平行语料*S*，*T*中对应（email，URL，较大的数字等）。
* 平行语料*S*，*T*的编辑距离（edit distance）必须大于某值（编辑距离相近对模型有负面影响）。
* 单句长度必须在某范围内（例如 2 < *N<sub>Token</sub>* < 80）。
* 使用Python langid package判断语言是否为目标语种。
* （待补充）

机器筛选后得到 *P<sub>R</sub>* 份待审核语料和 *P-P<sub>R</sub>* 份机器剔除语料。这一步骤的主要目的是去除没有进一步改进价值的语料，减少无谓的社区劳动损耗。

#### 3. 人工审核评分

将过滤后每一份语料交给 *R* 位社区成员审核，整个语料库共有 *AR* 位社区成员参与审核（每人工作量不一定相等），选项为 1-5 星，每位成员的打分为 *Score<sub>n</sub>*，每人的审核权重参数 *a<sub>R_n</sub>*。审核评分标准如下：

* 五星：+ 5分，表示完全无需修改
* 四星：+ 4分，表示存在瑕疵，仅需修改三个词以内便可评为五星
* 三星：+ 3分，表示需要修改三个以上字词，但句子顺序不需要大调整，没有无关的不对应的句子
* 二星：+ 2分，表示需要大量修改，或者包含无关不对应的句子
* 一星：+ 1分，表示错误语料，或需要重新翻译

<img src="/img/fig1.png" width="560">

总分为 *R* 位成员打分的加权平均，语料最终分数 *Score* 的范围为 [1, 5]，计算公式为：

<img src="/img/eq1.png" height="70" align="middle">

将语料按照打分排序等待下一步处理。

每人审核一对句子的工作量为 *W<sub>n</sub>* ，每个人在此语料库任务的工作总量记为 *∑W<sub>n</sub>*，所有人此任务的工作量加在一起记做 <img src="/img/eq2.png" height="40" align="middle">，则 *W<sub>Phase1</sub>* = <img src="/img/eq2.png" height="40" align="middle">。需要加入随机发放的挑战任务 *W<sub>CR</sub>* 防范恶意打分， *W<sub>CR</sub>* 包含在 *W<sub>Phase1</sub>* 中，占 5%（待商议）。

审核权重参数 *a<sub>R_n</sub>* 的范围是 *0.8 ≤ a<sub>R_n</sub> ≤ 1.2*，初始值根据新手任务完成情况确定，计算方法如下：

审核意见 *Score<sub>n</sub>* 与最终分数 *Score* 的标准差定义为评价打分质量的误差参数 *x*。将 *x* 按大小排序，误差参数 *x* 越低，说明用户打分质量越高。将 *x* 按照正态分布映射在 [0.8, 1.2] 的区间上（*x*越小，越靠近1.2），中值为 1，方差待定，得到每个人的权重参数 *a<sub>R_n</sub>*。之后可以根据社区收入情况调整该分布函数和参数。挑战任务回答正确不改变 *x*，回答错误一次，*x* 增大 0.05。

#### 4. 机器分组

此步骤无需社区人工。将语料按照打分排序 ，选出前 *k * P* 名作为最终语料，第 *k * P* 名语料的分数为及格线，如下图所示。

<img src="/img/fig2.png" width="560">

如果需要更多高质量语料，则可以将及格线附近的语料送入Phase 2进行编辑修改，获得更多可用语料。具体流程详见章节Phase 2。

#### 5. 总结

简单的语料清洗流程如下：

<img src="/img/fig3.png" width="560">

如果有进一步需求编辑修改语料，或重新制作，流程会进入Phase 2或3。详细的规则会在未来发布。

### **工作量估算**

*P<sub>R</sub>* 个句子的平行语料过滤任务中：

* 每份原始语料交给 *R* 个人审核打分，共审核打分 *R * P<sub>R</sub>* 次，共有 *AR* 位用户参与。
* 每份语料审核的工作量为 *W<sub>n</sub>* ，*W<sub>n</sub>* 会根据具体任务类型变化。
* *W<sub>CR</sub>* 为引入的挑战任务的工作总量。

这样，单位任务的总工作量为：

<img src="/img/eq3.png" height="55" align="middle">

发币预算 *BGE<sub>budget</sub>* 应与总工作量 *W<sub>Phase1</sub>* 挂钩。暂定1 Briko Granted Endorsement (BGE) = 1 min 工作量。

### **奖励规则与计算**

奖励的总原则是工作完成出色的，工作量大的社区成员，同等情况下获得较多奖励。

社区成员完成语料清洗任务得到BGE奖励，总量为 *BGE<sub>pay</sub>*。任务定义时的总预算为 *BGE<sub>budget</sub>*，总预算预留 *BGE<sub>res</sub>* 作为平台自留（补充任务，新人奖励等），*BGE<sub>fine</sub>* 为扣留押金，归平台所有，则预计支付  *BGE<sub>pay</sub> = BGE<sub>budget</sub> - BGE<sub>res</sub>*，实际支付*BGE<sub>paid</sub> = BGE<sub>budget</sub> - BGE<sub>res</sub> - BGE<sub>fine</sub>*。某成员应得的任务奖励由加权后的工作量得来，计算方法为：

<img src="/img/eq4.png" height="50" align="middle">

未来还会在权重参数中引入历史总工作量作为变量，历史总工作量大的成员同等情况下会得到较多的BGE奖励。

为减少恶意行为，社区成员接受每天的任务包时需要抵押任务价值1.5倍的BGE。任务完成后发回服务器等待评分收集完毕，计算任务包评分误差，该误差分只针对该任务包（不是用户的overall误差参数 *x*）。如果任务包误差分大于1.5星， 则认为用户恶意评分，扣除抵押BGE。因为抵押大于奖励，恶意行为会导致用户账户BGE减少。被认定是恶意评分的任务包会回收再发给其他成员重新完成。

Briko会用语料或服务所得收入在二级市场公开回购BGE，社区成员可以在市场上自由出售BGE，换取法币或其他数字货币。


## ——Phase 2 & 3——
（进行中...）

## 参考文献

[1] Jun Lu  and  Xiaoyu Lv  and  Yangbin Shi  and  Boing Chen, “Alibaba Submission to the WMT18 Parallel Corpus Filtering Task”, WMT18, 2018.

[2] Marcin Junczys-Dowmunt, “Dual Conditional Cross-Entropy Filtering of Noisy Parallel Corpora”, WMT18, 2018.
